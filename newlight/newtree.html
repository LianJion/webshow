 
<html>

<head>



<style type="text/css">
  /*canvas { border: 1px solid white; }*/
  body{
    background-color: black;
    overflow: hidden;
  }
</style>

</head>

<body>
  <canvas id="myCanvas" width="1500" height="800"></canvas>

  <script type="text/javascript">

    window.onload = function() {
      setInterval("drawFractalTree()",1000); 
      setInterval("fire()",1002);
    };
    var canvas = document.getElementById('myCanvas');
      if (canvas.getContext){
        var context = canvas.getContext('2d');
        var w = canvas.width = window.innerWidth;
        var h = canvas.height = window.innerHeight;
        var hasFired = false;
      }
      else{
        alert("HTML5 Canvas isn't supported by your browser!");
      }

      
   

    function drawFractalTree(){

      var randomAngle = Math.random()*90 + 45;
      console.log(randomAngle);
      var randomX = Math.random()*1000+ 200;
      var randomY = Math.random()*100 ;
      context.clearRect(0, 0, w, h);
      // clearCanvas();
      drawTree(randomX, randomY, randomAngle, 7);
    }


    function clearCanvas(){
      context.globalCompositeOperation = 'destination-out';
      context.fillStyle = 'rgba(0,0,0,'+random(1, 30)/100+')';
      context.fillRect(0,0,w,h);
      context.globalCompositeOperation = 'source-over';
    };
  
    function drawTree(x1, y1, angle, depth){

    var BRANCH_LENGTH = random(0,50);
    if (depth != 0){
        var x2 = x1 + (cos(angle) * depth * BRANCH_LENGTH);
        var y2 = y1 + (sin(angle) * depth * BRANCH_LENGTH);
        
        setTimeout(function(){
          var frame = 0;
          frame ++ ;
          var x3 = x1 + frame*(cos(angle) * depth * BRANCH_LENGTH);
          var y3 = y1 + frame*(sin(angle) * depth * BRANCH_LENGTH);
          if(x3 >= x2 || y3 >= y2) {
            x3 = x2;
            y3 = y2;
            hasFired = true;
          } else {
            hasFired = false;
          }
          context.strokeStyle = 'rgb(255,255, 255)'; //Green
          context.lineWidth = depth * 0.5;
          context.beginPath();
          context.moveTo(x1,y1);
          context.lineTo(x3,y3);
          context.closePath();
          context.stroke();
      

          // if(hasFired){
          //   console.log("a");
          //   context.fillStyle = '#313131';
          //   context.fillRect(0, 0, w, h); 
          //   hasFired = true;
          // }
        },250);

        // drawLine(x1,y1,x2,y2,depth);
        // if(!hasFired){
        //     console.log("a");
        //     context.fillStyle = 'rgba(255, 255, 255, '+ random(4, 12)/100+')';
        //     context.fillRect(0, 0, w, h);  
        //   }
        drawTree(x2, y2, angle - random(15,20), depth - 1);
        drawTree(x2, y2, angle + random(15,20), depth - 1);
      }
    }


    function fire() {
      context.fillStyle = '#313131';
      context.fillRect(0, 0, w, h);
    }
    // function drawLine(props) {
    //   var BRANCH_LENGTH = random(0, 20);
    //   var x = props.x;
    //   var y = props.y;
    //   //线条的粗细
    //   var thickness = props.thickness;
    //   var angle = props.angle;

    //   context.lineWidth = thickness * 0.5;
    //   context.strokeStyle = 'rgb(139,126, 102)';
    //   context.beginPath();
    //   context.moveTo(x, y);

    //   x += (cos(angle) * thickness * BRANCH_LENGTH);
    //   y += (sin(angle) * thickness * BRANCH_LENGTH);

    //   context.lineTo(x, y);
    //   context.stroke();
    //   context.closePath();


    //   setTimeout(function() {
    //     drawLine({
    //       x: x,
    //       y: y,
    //       thickness: thickness,
    //       angle: angle,
    //     });
    //   }, 100);
    // }

 
    

      
    function cos (angle) {
      return Math.cos(deg_to_rad(angle));
    }

    function sin (angle) {
      return Math.sin(deg_to_rad(angle));
    }

    function deg_to_rad(angle){
      return angle*(Math.PI/180.0);
    }

    function random(min, max){
      return min + Math.floor(Math.random()*(max+1-min));
    }


    function drawLine(x1, y1, x2, y2, thickness){
    
       
    
      context.strokeStyle = 'rgb(255,255, 255)'; //Green
      context.lineWidth = thickness * 0.5;
      context.beginPath();
      context.moveTo(x1,y1);
      context.lineTo(x2,y2);
      context.closePath();
      context.stroke();
      
    }


   /* var frame = 0;
    function drawLine(x1, y1, x2, y2, thickness){
      
      var x3 = x1 + frame*50;
      var y3 = y1 + frame*50;
      if(x3 >= x2 || y3 >= y2) {
        x3 = x2;
        y3 = y2;
      }

    
        context.strokeStyle = 'rgb(139,126, 102)'; //Green
    
        context.lineWidth = thickness * 0.5;
        context.beginPath();

        context.moveTo(x1,y1);

        context.lineTo(x3,y3);


        context.closePath();
        context.stroke();
    }*/
     
</script>
</body>

</html>